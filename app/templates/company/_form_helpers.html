{# app/templates/company/_form_helpers.html (UI改善版) #}

{% macro render_field(field, placeholder=None, type=None, rows=None, id=None, class_="", readonly=False, container_class="") %}
  {% set final_placeholder = placeholder if placeholder is not none else field.render_kw.get('placeholder') if field.render_kw else None %}
  {% set needs_date_ui = 'js-date' in class_ %}
  <div class="form-group {{ container_class }}" id="{{ field.name }}_group">
    {{ field.label(class="form-label") }}
    {% if needs_date_ui %}
      <div class="nr-date-picker" data-wrap="true">
        <button type="button" class="calendar-icon" aria-label="カレンダーを開く" data-toggle>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1V3a1 1 0 1 1 2 0v1zm12 6H5v10h14V8z"/>
          </svg>
        </button>
        {{ field(class=("form-control js-date " ~ class_)|trim, placeholder=final_placeholder, rows=rows, id=id, readonly=readonly, **{'data-input': ''}) }}
      </div>
    {% else %}
      {{ field(class=("form-control " ~ class_)|trim, placeholder=final_placeholder, type=type, rows=rows, id=id, readonly=readonly) }}
    {% endif %}
    {% if field.errors %}
      <div class="form-errors">
        {% for error in field.errors %}
          <span class="form-error">{{ error }}</span>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endmacro %}

{% macro render_radio_field(field) %}
<div class="form-group" id="{{ field.name }}_group">
    {{ field.label(class="form-label") }}
    <div class="segmented-control">
        {% for subfield in field %}
            {{ subfield(style="display:none;") }}
            {{ subfield.label }}
        {% endfor %}
    </div>
    {% if field.errors %}
    <div class="form-errors">
        {% for error in field.errors %}
        <span class="form-error">{{ error }}</span>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endmacro %}

{% macro render_checkbox_field(field, label_class='', container_class='') %}
<div class="form-group-checkbox {{ container_class }}">
    {{ field(class="form-checkbox") }}
    {{ field.label(class="form-label-checkbox " + label_class) }}
    {% if field.errors %}
    <div class="form-errors">
        {% for error in field.errors %}
        <span class="form-error">{{ error }}</span>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endmacro %}

{% macro render_toggle_switch(field) %}
  <label class="toggle-switch-container">
    {{ field(class="toggle-switch-input") }}
    <span class="toggle-switch"></span>
  </label>
{% endmacro %}

{# Date field with left calendar icon using flatpickr wrap mode (scoped to templates that use it) #}
{% macro render_date_field(field, placeholder=None, container_class="") %}
  <div class="form-group {{ container_class }}" id="{{ field.name }}_group">
    {{ field.label(class="form-label") }}
    <div class="nr-date-picker" data-wrap="true">
      <button type="button" class="calendar-icon" aria-label="カレンダーを開く" data-toggle>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1V3a1 1 0 1 1 2 0v1zm12 6H5v10h14V8z"/>
        </svg>
      </button>
      {{ field(class="form-control", placeholder=placeholder, **{'data-input': ''}) }}
    </div>
    {% if field.errors %}
      <div class="form-errors">
        {% for error in field.errors %}
          <span class="form-error">{{ error }}</span>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endmacro %}
