{# app/templates/company/_layout_helpers.html #}

{% macro render_page_header(title, subtitle, button_href, button_text, secondary_href=None, secondary_text=None, secondary_first=False) %}
<div class="page-header">
    <div class="header-content">
        <h1 class="content-title">{{ title }}</h1>
        <p class="content-subtitle">{{ subtitle }}</p>
    </div>
    <div class="header-actions">
        {% if secondary_first and secondary_href %}
            <a 
                href="{{ secondary_href }}" 
                class="button-secondary"
                target="_blank" rel="noopener"
            >
                {{ secondary_text or '' }}
            </a>
        {% endif %}
        <a 
            href="{{ button_href if button_href else '#' }}" 
            class="button-primary"
            {% if not button_href %}aria-disabled="true"{% endif %}
        >
            ＋ {{ button_text }}
        </a>
        {% if (not secondary_first) and secondary_href %}
            <a 
                href="{{ secondary_href }}" 
                class="button-secondary"
                target="_blank" rel="noopener"
            >
                {{ secondary_text or '' }}
            </a>
        {% endif %}
    </div>
</div>
{% endmacro %}

{% macro render_statement_table(title, data, order=None) %}
<div class="table-responsive">
    <table class="table table-bordered statement-table">
        <thead>
            <tr>
                <th colspan="2">{{ title }}</th>
            </tr>
        </thead>
        <tbody>
            {% set items_to_render = order if order else data.keys() %}
            {% for middle in items_to_render %}
                {% if middle in data and middle != 'total' %}
                    {% set middle_data = data[middle] %}
                    <tr class="middle-header">
                        <td>{{ middle }}</td>
                        <td class="amount">{{ "{:,.0f}".format(middle_data.get('total', 0)) }}</td>
                    </tr>
                    {% for item in middle_data.get('items', []) %}
                    <tr>
                        <td class="account-name indent-1">{{ item.name }}</td>
                        <td class="amount">{{ "{:,.0f}".format(item.amount) }}</td>
                    </tr>
                    {% endfor %}
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endmacro %}

{# Render difference value: if 0 -> 合致しました with green check, else -> formatted currency #}
{% macro render_difference(value) %}
    {% if (value | default(0)) == 0 %}
        <span class="match-status" title="差額0円">
            <span class="check-circle mini" aria-hidden="true"></span>合致しました
        </span>
    {% else %}
        {{ (value | default(0)) | format_currency }}
    {% endif %}
{% endmacro %}
