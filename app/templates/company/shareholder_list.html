{% extends "base.html" %}
{% from 'company/_layout_helpers.html' import render_page_header %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/shareholder_list.css') }}">
{% endblock %}

{% block title %}{{ page_title }}{% endblock %}

{% block sidebar %}
    {% include 'company/_wizard_sidebar.html' %}
{% endblock %}

{% block content %}
{{ render_page_header(
    title=page_title,
    subtitle='登録内容から自動で同族会社の判定を行うため、' ~ page_title ~ ' の作成は必須です。',
    button_url='company.register_shareholder',
    button_text='新規登録'
) }}

{% if shareholders %}
    <div class="shareholder-list">
        {% for shareholder in shareholders %}
        <div class="shareholder-card">
            <div class="shareholder-info">
                <p class="name">{{ shareholder.last_name or '' }} {{ shareholder.first_name or '' }}</p>
                <p class="position">{{ shareholder.officer_position or '役職未設定' }}</p>
            </div>
            <div class="shareholder-actions">
                <a href="{{ url_for('company.edit_shareholder', shareholder_id=shareholder.id) }}" class="action-icon edit-icon" title="編集">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                </a>
                <form action="{{ url_for('company.delete_shareholder', shareholder_id=shareholder.id) }}" method="post" onsubmit="return confirm('本当にこの情報を削除しますか？');" style="margin: 0;">
                    <button type="submit" class="action-icon delete-icon" title="削除">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <h2>まだ株主/社員が登録されていません</h2>
        <p>最初の株主/社員情報を登録しましょう。</p>
        <a href="{{ url_for('company.register_shareholder') }}" class="button-primary">＋ 新規登録</a>
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.context-menu-button').forEach(button => {
        button.addEventListener('click', (event) => {
            event.stopPropagation();
            // 他のメニューをすべて閉じる
            document.querySelectorAll('.context-menu-content').forEach(menu => {
                if (menu !== button.nextElementSibling) {
                    menu.style.display = 'none';
                }
            });
            // クリックされたメニューの表示を切り替える
            const menu = button.nextElementSibling;
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        });
    });

    // ドキュメントのどこかをクリックしたらメニューを閉じる
    document.addEventListener('click', () => {
        document.querySelectorAll('.context-menu-content').forEach(menu => {
            menu.style.display = 'none';
        });
    });
});
</script>
{% endblock %}