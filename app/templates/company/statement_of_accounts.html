{% extends "base.html" %}

{% block title %}{{ page_title }} - 勘定科目内訳書{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/statement_of_accounts.css') }}">
{% endblock %}

{% block sidebar %}
    {% include 'company/_wizard_sidebar.html' %}
{% endblock %}

{% from 'company/_layout_helpers.html' import render_difference %}
{% block content %}
<div class="content-header">
    <div class="header-main">
        <h1 class="content-title">{{ page_title }}の内訳</h1>
        <p class="content-subtitle">登録された{{ page_title }}の情報を確認・編集します。</p>
    </div>
    <div class="header-actions">
        {# 差額=0のときは新規登録を隠し、次の内訳へボタンを表示（次URLがある場合） #}
        {% if generic_summary and (generic_summary.difference | default(0)) == 0 and soa_next_url %}
            <a href="{{ soa_next_url }}" class="button-primary">次の内訳へ</a>
        {% else %}
            <a href="{{ url_for('company.add_item', page_key=page) }}" class="button-primary">＋ 新規登録</a>
        {% endif %}
        {# 検証用のPDF出力（検証用。サービスリリース時は非表示前提） #}
        {% if page == 'deposits' %}
            <a href="{{ url_for('company.deposits_pdf', year='2025') }}" class="button-secondary" target="_blank" rel="noopener">PDF出力（預貯金等・検証用）</a>
        {% elif page == 'accounts_receivable' %}
            <a href="{{ url_for('company.accounts_receivable_pdf', year='2025') }}" class="button-secondary" target="_blank" rel="noopener">PDF出力（売掛金・検証用）</a>
        {% endif %}
    </div>
</div>

{% if page == 'deposits' %}
<div class="card summary-card">
    <div class="summary-item">
        <span class="summary-label">B/S上の預金残高</span>
        <span class="summary-value">{{ (deposit_summary.bs_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item">
        <span class="summary-label">内訳明細の合計額</span>
        <span class="summary-value">{{ (deposit_summary.breakdown_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item result {% if deposit_summary.difference == 0 %}zero{% else %}non-zero{% endif %}">
        <span class="summary-label">差額</span>
        <span class="summary-value">{{ render_difference(deposit_summary.difference) }}</span>
        {# 整合済みバッジは非表示 #}
    </div>
    {# 主要CTAはヘッダ右上で制御。サマリー内にCTAは置かない（UI方針） #}
</div>
{% endif %}

{% if page == 'notes_receivable' %}
<div class="card summary-card">
    <div class="summary-item">
        <span class="summary-label">B/S上の受取手形残高</span>
        <span class="summary-value">{{ (notes_receivable_summary.bs_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item">
        <span class="summary-label">内訳明細の合計額</span>
        <span class="summary-value">{{ (notes_receivable_summary.breakdown_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item result {% if notes_receivable_summary.difference == 0 %}zero{% else %}non-zero{% endif %}">
        <span class="summary-label">差額</span>
        <span class="summary-value">{{ render_difference(notes_receivable_summary.difference) }}</span>
        {# 整合済みバッジは非表示 #}
    </div>
    {# 主要CTAはヘッダ右上で制御。サマリー内にCTAは置かない（UI方針） #}
</div>
{% endif %}

{% if page == 'accounts_receivable' %}
<div class="card summary-card">
    <div class="summary-item">
        <span class="summary-label">B/S上の売掛金（未収入金）残高</span>
        <span class="summary-value">{{ (accounts_receivable_summary.bs_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item">
        <span class="summary-label">内訳明細の合計額</span>
        <span class="summary-value">{{ (accounts_receivable_summary.breakdown_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item result {% if (accounts_receivable_summary.difference | default(0)) == 0 %}zero{% else %}non-zero{% endif %}">
        <span class="summary-label">差額</span>
        <span class="summary-value">{{ render_difference(accounts_receivable_summary.difference) }}</span>
        {# 整合済みバッジは非表示 #}
    </div>
    {# 主要CTAはヘッダ右上で制御。サマリー内にCTAは置かない（UI方針） #}
</div>
{% endif %}

{% if page in ['temporary_payments','loans_receivable','inventories','securities','fixed_assets','notes_payable','accounts_payable','temporary_receipts','executive_compensations','land_rents','miscellaneous'] %}
<div class="card summary-card">
    <div class="summary-item">
        <span class="summary-label">{{ generic_summary_label }}</span>
        <span class="summary-value">{{ (generic_summary.bs_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item">
        <span class="summary-label">内訳明細の合計額</span>
        <span class="summary-value">{{ (generic_summary.breakdown_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item result {% if (generic_summary.difference | default(0)) == 0 %}zero{% else %}non-zero{% endif %}">
        <span class="summary-label">差額</span>
        <span class="summary-value">{{ render_difference(generic_summary.difference) }}</span>
        {# 整合済みバッジは非表示 #}
    </div>
    {# 主要CTAはヘッダ右上で制御。サマリー内にCTAは置かない（UI方針） #}
</div>
{% endif %}

{% if page == 'borrowings' %}
<div class="card summary-card">
    <div class="summary-item">
        <span class="summary-label">B/S上の借入金残高</span>
        <span class="summary-value">{{ (borrowings_summary.bs_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item">
        <span class="summary-label">P/L上の支払利子</span>
        <span class="summary-value">{{ (borrowings_summary.pl_interest_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item">
        <span class="summary-label">内訳明細の合計額（期末現在高＋期間中の支払利子）</span>
        <span class="summary-value">{{ (borrowings_summary.breakdown_total | default(0)) | format_currency }}</span>
    </div>
    <div class="summary-item result {% if (borrowings_summary.difference | default(0)) == 0 %}zero{% else %}non-zero{% endif %}">
        <span class="summary-label">差額</span>
        <span class="summary-value">{{ render_difference(borrowings_summary.difference) }}</span>
        {# 整合済みバッジは非表示 #}
    </div>
</div>
{% endif %}

<div class="card-grid">
    {% if items %}        {% include 'company/_cards/' + page + '_card.html' %}
    {% else %}
        <div class="empty-state-card">
            <h2>まだ{{ page_title }}が登録されていません</h2>
            <p>右上の「＋ 新規登録」ボタンから最初の情報を登録してください。</p>
            <a href="{{ url_for('company.add_item', page_key=page) }}" class="button-primary">最初の{{ page_title }}を登録する</a>
        </div>
    {% endif %}
</div>
{% endblock %}
