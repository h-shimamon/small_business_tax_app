# サイドバー進捗（丸表示）— 完了条件の保存メモ（DRAFT）

状態語彙の統一（基準: 勘定科目内訳書 SoA）
- アクティブ: 青丸（最優先）
- 完了: 緑丸 + 白い ✓（非アクティブ時に表示）
- 未完了: 赤丸（非アクティブで未完了）
- スキップ: 黒丸（SoAのみ適用。他グループでは使用しない）

適用範囲
- 基本情報グループ: スキップ無し（青/緑✓/赤）。
- 会計データ選択（ウィザード）: スキップ無し（青/緑✓/赤）。
- 勘定科目内訳書（SoA）: 現行どおり（青/緑✓/赤 + 黒）。

完了条件（暫定・後から変更あり）
- 基本情報
  - 基本情報: Company の必須項目が埋まっている。
  - 株主/社員情報: 主たる株主グループが 1 件以上。
  - 申告情報: 会計期間（開始/終了）が設定済み。
  - 事業所一覧: 事業所が 1 件以上登録。
- 会計データ選択（ウィザード）
  - 会計ソフト選択: 選択済みフラグあり。
  - 勘定科目データ取込: インポート済み（該当テーブルのレコード有無）。
  - 勘定科目マッピング: マッピング完了フラグ or 対応テーブルの充足。
  - 仕訳帳データ取込: インポート済み。
  - 残高試算表の確認: 確認済みフラグ（なければインポート充足で暫定代替）。
  - 固定資産データ取込: インポート済み。
- SoA: 差額=0 で完了。参照合計=0 はスキップ（SoAのみ）。

運用方針（開発環境）
- いまは開発環境のため、「完了条件を満たさないと先に進めない」等のゲーティングは適用しない。
- 最終段階で完了条件とゲーティング仕様を確定し、必要に応じて有効化（Feature Flag で切替想定）。

実装ノート（将来方針・ドラフト）
- 判定は Pluggable Evaluator（各グループ/ステップごとに関数登録）で一カ所に集約。
- SoA のスキップは既存の `compute_skipped_steps_for_company` を継続利用。
- 有効化は設定/環境変数で制御（例: `NAV_PROGRESS_ENFORCE=false` 既定）。


## CTA配置方針（UI方針）
- 主要CTAはヘッダ右上に集約する。差額=0かつ次ページがある場合は「次の内訳へ」を表示し、それ以外は「＋ 新規登録」を表示する。
- サマリー内にナビゲーション用CTA（ボタン/リンク）は配置しない。視線導線と一貫性、アクセシビリティのためヘッダに集約する。
- `soa_next_url` / `soa_next_name` はヘッダ表示のためのコンテキスト変数。テンプレートでの使用箇所はヘッダに限定する。
